<div [@routerTransition]>
    <section class="content-header">
        <div class="container-fluid">
            <div class="row">
                <h3>Deconturi</h3>
            </div>
        </div>
    </section>
    <section class="content px-2">
        <div class="container-fluid">
            <div class="body">
                <div class="row">
                    <div class="col-lg-4">
                        <label for="thirdPartyId" class="col-form-label"> Angajat</label>
                        <mat-form-field style="width: 100%;">
                            <input type="text" matInput id="thirdParty"
                                   name="thirdParty"
                                   [(ngModel)]="decontInit.thirdPartyId"
                                   #thirdPartyId="ngModel"
                                   (input)="searchThirdParty($event)"
                                   required
                                   [matAutocomplete]="auto">
                            <mat-autocomplete #auto="matAutocomplete" [displayWith]="getThirdPartyName.bind(this)">
                                <mat-select *ngFor="let thirdParty of thirdParties?.getThirdParty">
                                    <mat-option (click)="selectedThirdParty(thirdParty.personId, thirdParty.fullName)" [ngValue]="thirdParty.personId">
                                        {{ thirdParty.fullName }}
                                    </mat-option>
                                </mat-select>
                            </mat-autocomplete>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <label for="decontStartDate" class="col-form-label">Data start decont</label>
                        <mat-form-field style="width: 100%;">
                            <input matInput
                                   id="decontStartDate"
                                   name="decontStartDate"
                                   [matDatepicker]="decontStartDatePicker"
                                   [(ngModel)]="decontInit.decontStartDate"
                                   #decontStartDate="ngModel">
                            <mat-datepicker-toggle matSuffix [for]="decontStartDatePicker"></mat-datepicker-toggle>
                            <mat-datepicker #decontStartDatePicker></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <label for="decontEndDate" class="col-form-label">Data sfarsit decont</label>
                        <mat-form-field style="width: 100%;">
                            <input matInput
                                   id="decontEndDate"
                                   name="decontEndDate"
                                   [matDatepicker]="decontEndDatePicker"
                                   [(ngModel)]="decontInit.decontEndDate"
                                   #deconteEndDate="ngModel">
                            <mat-datepicker-toggle matSuffix [for]="decontEndDatePicker"></mat-datepicker-toggle>
                            <mat-datepicker #decontEndDatePicker></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <label for="documentType" class="col-form-label"> Tip document</label>
                        <select id="documentType" name="documentType" class="form-control" [(ngModel)]="decontInit.documentType" #documentType="ngModel">
                            <option value="-">Selecteaza</option>
                            <option value="DEC">Decont</option>
                            <option value="OD">Ordin deplasare</option>
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <label for="decontTypeId" class="col-form-label">Tip decont</label>
                        <select id="decontTypeId"
                                name="decontTypeId"
                                [(ngModel)]="decontInit.decontTypeId"
                                #decontTypeId="ngModel"
                                class="form-control">
                            <option [ngValue]="null">Selecteaza</option>
                            <option *ngFor="let res of decontTypeList" [ngValue]="res.id">{{ res.name }}</option>
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <label for="scopDeplasareTypeId" class="col-form-label"> Scop delegatie</label>
                        <select id="scopDeplasareTypeId"
                                name="scopDeplasareTypeId"
                                [(ngModel)]="decontInit.scopDeplasareTypeId"
                                #scopDeplasareTypeId="ngModel"
                                class="form-control">
                            <option [ngValue]="null">Selecteaza</option>
                            <option *ngFor="let res of scopDeplasareList" [ngValue]="res.id">{{res.name}}</option>
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <label class="col-form-label">Perioada deplasare</label>
                        <input type="text"
                               placeholder="Data inceput - Data sfarsit"
                               class="form-control"
                               [(ngModel)]="rangeDateDelegatie"
                               bsDaterangepicker
                               (ngModelChange)="searchDecontList()"
                               [bsConfig]="{ isAnimated: true, dateInputFormat: 'dd/MM/YYYY' }">
                    </div>
                    <div class="col-lg-2">
                        <label for="diurnaLegalaId" class="col-form-label">Tara deplasare</label>
                        <select id="diurnaLegalaId"
                                name="diurnaLegalaId"
                                class="form-control"
                                [(ngModel)]="decontInit.diurnaLegalaId"
                                #diurnaLegalaId="ngModel">
                            <option [ngValue]="null">Selecteaza</option>
                            <option *ngFor="let item of diurnaList" [ngValue]="item.id">{{item.countryName}}</option>
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <button class="btn btn-info" title="Cauta" (click)="searchDecontList()">
                            <i class="fas fa-search"></i>
                        </button>
                        <a href="{{appBaseUrl}}/assets/pdf/Conta - Doc primite si emise si deconturi - Manual utilizare.pdf" title="Manual de utilizare" class="btn btn-info ml-2" target="_blank"><i class="fas fa-question"></i></a>
                    </div>
                </div>
                <div class="panel-heading mt-3" style="position: relative;">
                    <div class="row">
                        <h4 class="panel-title col-xs-6">
                            Deconturi - <span>{{ getDecontCount() }}</span> &nbsp;
                            <a [routerLink]="['/app/decontAdd']" *ngIf="isGranted('Conta.Deconturi.Modificare')" class="btn btn-info"><i class="fas fa-plus"></i></a>
                        </h4>
                    </div>
                </div>

                <dx-data-grid id="gridContainerDecont"
                              [dataSource]="decontInit.decontList"
                              [showBorders]="true"
                              [allowColumnResizing]="true"
                              [wordWrapEnabled]="true"
                              [remoteOperations]="false"
                              (onCellPrepared)="onCellPrepared($event)">
                    <dxo-editing model="cell"
                                 [allowUpdating]="false"
                                 [allowAdding]="false"
                                 [allowDeleting]="false">
                    </dxo-editing>
                    <dxo-group-panel [visible]="true"></dxo-group-panel>
                    <dxo-grouping [autoExpandAll]="true"></dxo-grouping>
                    <dxo-selection mode="multiple"></dxo-selection>

                    <dxi-column dataField="documentName" caption="Tip document"></dxi-column>
                    <dxi-column dataField="decontNumber" caption="Nr decont" [width]="70"></dxi-column>
                    <dxi-column dataField="decontDate" caption="Data decont" dataType="date" [format]="'dd/MM/yyyy'" alignment="center"></dxi-column>
                    <dxi-column dataField="thirdParty" caption="Angajat"></dxi-column>
                    <dxi-column dataField="scopDeplasareTypeName" caption="Scop delegatie"></dxi-column>
                    <dxi-column [calculateDisplayValue]="getDataStartEnd" caption="Perioada delegatie"></dxi-column>
                    <dxi-column dataField="totalDiurnaAcordata" caption="Total diurna acordata">
                        <dxo-format type="fixedPoint" [precision]="2"></dxo-format>
                    </dxi-column>
                    <dxi-column dataField="totalDiurnaImpozabila" caption="Total diurna impozabila">
                        <dxo-format type="fixedPoint" [precision]="2"></dxo-format>
                    </dxi-column>
                    <dxi-column dataField="decontType" caption="Tip decont"></dxi-column>
                    <dxi-column type="buttons">
                        <dxi-button icon="edit" text="Editare" [onClick]="editDecont" [visible]="isVisible"></dxi-button>
                        <dxi-button icon="trash" text="Stergere" [onClick]="deleteDecont" [visible]="isVisible"></dxi-button>
                    </dxi-column>

                    <dxo-export [enabled]="true" [allowExportSelectedData]="true"></dxo-export>

                </dx-data-grid>

                <!--<table class="table small-font">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Tip document</th>
                            <th scope="col">Nr decont</th>
                            <th scope="col">Data decont</th>
                            <th scope="col">Angajat</th>
                            <th scope="col">Scop delegatie</th>
                            <th scope="col">Perioada delegatiei</th>
                            <th scope="col">Diurna </th>
                            <th scope="col">Tip decont</th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of decontInit.decontList; let i = index">
                            <td>{{ i + 1 }}</td>
                            <td>{{ item.documentName }}</td>
                            <td>{{ item.decontNumber }}</td>
                            <td>{{ item.decontDate | date: 'dd.MM.yyyy' }}</td>
                            <td>{{ item.thirdParty }}</td>
                            <td>{{ item.scopDeplasareTypeName }}</td>
                            <td>{{ item.dateStart | date: 'dd.MM.yyyy'}} - {{ item.dateEnd  | date: 'dd.MM.yyyy' }}</td>
                            <td>{{ item.diurna }}</td>
                            <td>{{ item.decontType }} </td>
                            <td>
                                <a [routerLink]="['/app/decontAdd']"
                                   [queryParams]="{ decontId: item.id }"
                                   class="btn btn-info"
                                   title="Editare"><i class="fas fa-edit"></i></a>
                            </td>
                            <td>
                                <button (click)="deleteDecont(item.id)"
                                        class="btn btn-danger"
                                        title="Stergere">
                                    <i class="fas fa-trash">  </i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>-->
            </div>
        </div>
    </section>
</div>