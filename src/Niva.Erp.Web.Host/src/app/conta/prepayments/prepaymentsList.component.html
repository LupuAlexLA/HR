<div [@routerTransition]>
    <section class="content-header">
        <div class="container-fluid">
            <div class="row">
                <h3 *ngIf="prepaymentType == 0">
                    Cheltuieli in avans

                </h3>
                <h3 *ngIf="prepaymentType == 1">
                    Venituri in avans
                </h3>
            </div>
        </div>
    </section>
    <section class="content px-2">
        <div class="container-fluid">
            <div class="body">
                <div class="row">
                    <div class="col-lg-2">
                        <label for="dataStart" class="col-form-label">Data Start</label>
                        <mat-form-field style="width: 100%">
                            <input matInput [matDatepicker]="dataStartPicker" id="dataStart"
                                   name="dataStart" [(ngModel)]="dataStart" />
                            <mat-datepicker-toggle matSuffix [for]="dataStartPicker"></mat-datepicker-toggle>
                            <mat-datepicker #dataStartPicker></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <label for="dataEnd" class="col-form-label">Data Sfarsit</label>
                        <mat-form-field style="width: 100%">
                            <input matInput [matDatepicker]="dataEndPicker" id="dataEnd"
                                   name="dataEnd" [(ngModel)]="dataEnd" />
                            <mat-datepicker-toggle matSuffix [for]="dataEndPicker"></mat-datepicker-toggle>
                            <mat-datepicker #dataEndPicker></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-1">
                        <button (click)="prepaymentsListFnc()" class="btn btn-info" title="Cauta"><i class="fas fa-search"></i></button>
                        <a href="{{appBaseUrl}}/assets/pdf/Conta - Cheltuieli in avans - Manual utilizare.pdf"  title="Manual de utilizare" class="btn btn-info ml-2" target="_blank"><i class="fas fa-question"></i></a>
                    </div>
                </div>
                <div class="panel-heading" style="position: relative;">
                    <div class="row">
                        <h4 class="panel-title col-xs-6">
                            <span *ngIf="prepaymentType==0">Cheltuieli In Avans</span>
                            <span *ngIf="prepaymentType==1">Venituri In Avans</span>
                            <span> - {{ getPrepaymentsListCount() }}</span> &nbsp;
                            <a [routerLink]="['/app/conta/prepayments/prepaymentsAdd']"
                               [queryParams]="{prepaymentType: prepaymentType}"
                               class="btn btn-info"
                               *ngIf="(prepaymentType === 0 ? isGranted('Conta.CheltAvans.Chelt.Modificare') : isGranted('Conta.VenitAvans.Venituri.Modificare'))"><i class="fas fa-plus"></i></a>
                        </h4>
                    </div>
                </div>
                <table class="table small-font">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Denumire</th>
                            <th scope="col">Furnizor</th>
                            <th scope="col">Factura</th>
                            <th scope="col">Valoare</th>
                            <th scope="col">Data inregistrarii</th>
                            <th scope="col">Data calcul amortizare</th>
                            <th scope="col">Durata (<span *ngIf="modCalcul == 0">luni</span><span *ngIf="modCalcul == 1">zile</span>)</th>
                            <th scope="col">Data iesire din gestiune</th>
                            <th scope="col">Procesat</th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let prepayment of prepaymentsList; let i = index;">
                            <td scope="row">{{ i + 1 }}</td>
                            <td>{{prepayment.description}}</td>
                            <td>{{prepayment.thirdParty}}</td>
                            <td>{{prepayment.invoice}}</td>
                            <td>{{prepayment.prepaymentValue | number}}</td>
                            <td>{{prepayment.paymentDate | date: 'dd/MM/yyyy'}}</td>
                            <td>{{prepayment.depreciationStartDate | date: 'dd/MM/yyyy'}}</td>
                            <td>{{prepayment.durationInMonths}}</td>
                            <td><span *ngIf="prepayment.endDate != null">{{ prepayment.endDate | date: 'dd/MM/yyyy' }}</span></td>
                            <td>
                                <input id="processed_{{i}}" name="processed_{{i}}" type="checkbox" [(ngModel)]="prepayment.processed" *ngIf="prepayment.processed" [disabled]="true" />
                                <label for="processed_{{i}}" class="col-form-label" *ngIf="prepayment.processed"></label>
                            </td>
                            <td>
                                <a [routerLink]="['/app/conta/prepayments/prepaymentsAddDirect']"
                                   [queryParams]="{prepaymentId: prepayment.id, prepaymentType: prepaymentType}"
                                   class="btn btn-info"
                                   *ngIf="!prepayment.processedOut" title="Modifica"><i class="fas fa-edit"></i> </a>
                            </td>
                            <td>
                                <a [routerLink]="['/app/conta/prepayments/prepaymentsExit']"
                                   [queryParams]="{prepaymentId: prepayment.id, prepaymentType: prepaymentType}"
                                   class="btn btn-info"
                                   *ngIf="!prepayment.processedOut" title="Iesire din gestiune"><i class="fas fa-sign-out-alt"></i> </a>
                            </td>
                            <td>
                                <button (click)="deletePrepayment(prepayment.id)" class="btn btn-danger" *ngIf="!prepayment.processed && (prepaymentType === 0 ? isGranted('Conta.CheltAvans.Chelt.Modificare') : isGranted('Conta.VenitAvans.Venituri.Modificare'))" title="Sterge"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</div>